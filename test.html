<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>MySQL实践总结</title>
<!-- 2015-04-04 六 14:02 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Jerry Xu" />
<meta  name="description" content="Some MySQL practice experience, including table management, user management , garbage characters fixing and some error fixing."
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">MySQL实践总结</h1>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">MySQL5.x在Windows平台下的安装配置-test</h2>
<div class="outline-text-2" id="text-1">
<ol class="org-ol">
<li>下载
首先到<a href="http://www.mysql.com/downloads/mysql/">http://www.mysql.com/downloads/mysql/</a> 下载安装文件，我选择的是非安装版（noinstall）。安装版与非安装版的区别是安装版自动添加服务，而非安装版需要手动添加服务。
</li>
<li>解压
将下载的压缩文件解压到安装目录中，比如F:Files\。
</li>
<li>添加MySQL的服务
将MySQL添加到Windows的服务中，可以使MySQL开机启动。具体步骤如下：
1.复制MySQL安装目录下的my-medium.ini为my.ini(根据需要也可以复制其它my-*.ini)
2.在运行中输入cmd，获得Windows命令行，输入F:Files-5.1.50-win32&#x2013;install MySQL &#x2013;defaults-file=F:Files-5.1.50-win32.ini，其中MySQL是服务名，defaults-file是MySQL的配置文件。
3.启动和停止MySQL
法一、命令行中输入net start (服务名)或net stop (服务名)
法二、在运行中输入services.msc，找到MySQL进行操作。
</li>
<li>设置MySQL
打开my.ini，找到[mysqld]，添加
<div class="org-src-container">

<pre class="src src-conf-windows"><span class="linenr">1: </span><span style="color: #268bd2;">character-set-server</span>=utf8
<span class="linenr">2: </span><span style="color: #268bd2;">collation-server</span>=utf8_general_ci
<span class="linenr">3: </span><span style="color: #268bd2;">default-character-set</span>=utf8
</pre>
</div>
<p>
找到[mysql]，添加
</p>
<div class="org-src-container">

<pre class="src src-conf-windows"><span class="linenr">1: </span>no-beep
<span class="linenr">2: </span><span style="color: #268bd2;">default-character-set</span>=utf8
</pre>
</div>
<p>
上面添加的选项如果已经存在就修改它为上面的值。
</p>
</li>
<li>从外部导入sql脚本
1.图形工具要注意设置文件的编码
2.使用命令行mysql需要先运行：set names (sql文件的编码)
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">连接与断开服务器 (参考MySQL5.1中文参考手册，jerry整理)</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>mysql -h host -u user -p
<span class="linenr">2: </span>Enter password: ********
</pre>
</div>
<p>
host和user分别代表MySQL服务器运行的主机名和MySQL账户用户名。
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">创建数据库和用户 (包括如何避免乱码)</h2>
<div class="outline-text-2" id="text-3">
<ol class="org-ol">
<li>创建并选择数据库
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE DATABASE menagerie CHARACTER SET utf8 COLLATE utf8_general_ci;
</pre>
</div>
<p>
创建数据库的时候指定编码可以防止出现乱码。创建数据库并不表示选定并使用它，你必须明确地操作。为了使menagerie成为当前的数据库，使用这个命令：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>USE menagerie
</pre>
</div>
</li>
<li>创建用户并赋予用户权限
为数据库创建单独的用户，这样可以最小化用户的权限，提高数据库的安全性。使用下面的命令创建用户并赋予用户对数据库menagerie的操作权限：
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>GRANT ALL PRIVILEGES ON menagerie.* TO <span style="color: #2aa198;">'user'</span>@<span style="color: #2aa198;">'localhost'</span> identified by <span style="color: #2aa198;">'password'</span>;
</pre>
</div>
<p>
该代码创建了一个叫user的用户，该用户在数据库服务器本地对数据库menagerie所有的操作权限。
</p>
</li>
<li>创建表
创建数据库是很容易的部分，但是在这时它是空的，正如SHOW TABLES将告诉你的：
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>SHOW TABLES;
</pre>
</div>
<p>
Empty set (0.00 sec)
使用下面的命令创建表：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE TABLE TableA <span style="color: #2aa198;">(</span>
<span class="linenr">2: </span> // contents going here
<span class="linenr">3: </span><span style="color: #2aa198;">)</span> ENGINE=INNODB DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
</pre>
</div>
</li>
<li>使用JDBC连接数据库
<pre class="example">
jdbc:mysql://localhost:3306/database?useUnicode=true&amp;amp;characterEncoding=UTF-8
</pre>
</li>
<li>使数据库表的id重新从1开始编号
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>truncate table &#34920;&#21517;
</pre>
</div>
</li>
<li>开启远程连接
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>GRANT ALL PRIVILEGES ON *.* TO <span style="color: #2aa198;">'myuser'</span>@<span style="color: #2aa198;">'%'</span>IDENTIFIED BY <span style="color: #2aa198;">'mypassword'</span> WITH GRANT OPTION;
</pre>
</div>
<p>
修改/etc/mysql/my.cnf
</p>
<div class="org-src-container">

<pre class="src src-conf"><span class="linenr">1: </span><span style="color: #268bd2;">bind-address</span>=127.0.0.1
</pre>
</div>
<p>
然后
</p>
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>sudo /etc/init.d/mysql restart
</pre>
</div>
</li>
<li>Hibernate写入MySQL乱码
Hibernate MySQL 中文乱码问题
环境：Hibernate 3 + MySQL5.0（MySQL的编码已设置为utf8）
<ol class="org-ol">
<li>问题：通过Hibernate向MySQL写入中文后，通过Hibernate取回数据，在console中打印java对象显示正常。但在MySQL Query Browser中看到的是乱码。
原因：Hibernate的基础还是JDBC，所以一样需要设置characterEncoding！
</li>
<li>解决方法：
在 hibernate.cfg.xml中应该这样写
<div class="org-src-container">

<pre class="src src-nxml"><span class="linenr">1: </span>&lt;<span style="color: #268bd2;">property</span> <span style="color: #268bd2;">name</span>=<span style="color: #2aa198;">"</span><span style="color: #2aa198;">connection.url</span><span style="color: #2aa198;">"</span>&gt;jdbc:mysql://localhost:3306/test?useUnicode=true<span style="color: #268bd2; font-weight: bold;">&amp;</span><span style="color: #268bd2; font-weight: bold;">amp</span><span style="color: #268bd2; font-weight: bold;">;</span>characterEncoding=UTF-8&lt;/<span style="color: #268bd2;">property</span>&gt;
</pre>
</div>
<p>
如果用hibernate.properties
</p>
<div class="org-src-container">

<pre class="src src-conf-javaprop"><span class="linenr">1: </span><span style="color: #268bd2;">hibernate.connection.url</span> jdbc:mysql:<span style="color: #93a1a1; font-style: italic;">//</span><span style="color: #93a1a1;">localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8</span>
</pre>
</div>
<p>
ps：处理中文的话，characterEncoding用GBK也可以。不过UTF-8可以表示其它更多语言的字符。
</p>
</li>
</ol>
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">数据库管理</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">备份与恢复</h3>
<div class="outline-text-3" id="text-4-1">
</div><div id="outline-container-sec-4-1-1" class="outline-4">
<h4 id="sec-4-1-1">mysqldump：数据库备份程序</h4>
<div class="outline-text-4" id="text-4-1-1">
<ol class="org-ol">
<li>mysqldump经常用来个备份整个数据库，备份的命令如下：
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>mysqldump --opt db_name -h host -u user -p &gt; backup-file.sql
</pre>
</div>
</li>
<li>如果只想如果你只想转储表的结构，用下面的命令：
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>mysqldump --opt db_name -h host -u user -p -d &gt; backup-file.sql
</pre>
</div>
<p>
或者
</p>
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>mysqldump --opt db_name -h host -u user -p --no-data &gt; backup-file.sql
</pre>
</div>
</li>
<li>如果指向转储表的数据而没有create table的语句，用如下的命令：
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>mysqldump --opt db_name -h host -u user -p -t &gt; backup-file.sql
</pre>
</div>
</li>
<li>mysqldump也可用于从一个MySQL服务器向另一个服务器复制数据时装载数据库：
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>mysqldump --opt db_name | mysql --host=remote_host -C db_name
</pre>
</div>
</li>
<li>可以用一个命令转储几个数据库：
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>mysqldump ---database db_name1 <span style="color: #2aa198;">[</span>db_name2 ...<span style="color: #2aa198;">]</span> &gt; my_databases.sql
</pre>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-4-1-2" class="outline-4">
<h4 id="sec-4-1-2">将转储文件读回到服务器 (恢复)</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>mysql db_name &lt; backup-file.sql
</pre>
</div>
<p>
或者为：
</p>
<div class="org-src-container">

<pre class="src src-sh"><span class="linenr">1: </span>mysql -e <span style="color: #2aa198;">"source /path-to--backup/backup-file.sql"</span> db_name
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">字符集支持</h2>
<div class="outline-text-2" id="text-5">
<p>
字符集是一套符号和编码。校对规则是在字符集内用于比较字符的一套规则。
</p>
</div>
<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">确定默认字符集和校对</h3>
<div class="outline-text-3" id="text-5-1">
<p>
字符集和校对规则有4个级别的默认设置：服务器级、数据库级、表级和连接级。
</p>
<ol class="org-ol">
<li>服务器字符集和校对
</li>
<li>数据库字符集和校对
每一个数据库有一个数据库字符集和一个数据库校对规则，它不能够为空。CREATE DATABASE和ALTER DATABASE语句有一个可选的子句来指定数据库字符集和校对规则：
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE DATABASE db_name
<span class="linenr">2: </span><span style="color: #2aa198;">[</span><span style="color: #b58900;">[</span>DEFAULT<span style="color: #b58900;">]</span> CHARACTER SET charset_name<span style="color: #2aa198;">]</span>
<span class="linenr">3: </span><span style="color: #2aa198;">[</span><span style="color: #b58900;">[</span>DEFAULT<span style="color: #b58900;">]</span> COLLATE collation_name<span style="color: #2aa198;">]</span>
<span class="linenr">4: </span>
<span class="linenr">5: </span>ALTER DATABASE db_name
<span class="linenr">6: </span><span style="color: #2aa198;">[</span><span style="color: #b58900;">[</span>DEFAULT<span style="color: #b58900;">]</span> CHARACTER SET charset_name<span style="color: #2aa198;">]</span>
<span class="linenr">7: </span><span style="color: #2aa198;">[</span><span style="color: #b58900;">[</span>DEFAULT<span style="color: #b58900;">]</span> COLLATE collation_name<span style="color: #2aa198;">]</span>
</pre>
</div>
<p>
例如：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE DATABASE db_name
<span class="linenr">2: </span>DEFAULT CHARACTER SET latin1 COLLATE latin1_swedish_ci;
</pre>
</div>
<p>
MySQL这样选择数据库字符集和数据库校对规则：
· 如果指定了CHARACTER SET X和COLLATE Y，那么采用字符集X和校对规则Y。
· 如果指定了CHARACTER SET X而没有指定COLLATE Y，那么采用CHARACTER SET X和CHARACTER SET X的默认校对规则。
· 否则，采用服务器字符集和服务器校对规则。
</p>
</li>
<li>表字符集和校对
每一个表有一个表字符集和一个校对规则，它不能为空。为指定表字符集和校对规则，CREATE TABLE 和ALTER TABLE语句有一个可选的子句：
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE TABLE tbl_name <span style="color: #2aa198;">(</span>column_list<span style="color: #2aa198;">)</span>
<span class="linenr">2: </span><span style="color: #2aa198;">[</span>DEFAULT CHARACTER SET charset_name <span style="color: #b58900;">[</span>COLLATE collation_name<span style="color: #b58900;">]</span><span style="color: #2aa198;">]</span>
<span class="linenr">3: </span>
<span class="linenr">4: </span>ALTER TABLE tbl_name
<span class="linenr">5: </span><span style="color: #2aa198;">[</span>DEFAULT CHARACTER SET charset_name<span style="color: #2aa198;">]</span> <span style="color: #2aa198;">[</span>COLLATE collation_name<span style="color: #2aa198;">]</span>
</pre>
</div>
<p>
例如：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE TABLE t1 <span style="color: #2aa198;">(</span> ... <span style="color: #2aa198;">)</span>
<span class="linenr">2: </span>DEFAULT CHARACTER SET latin1 COLLATE latin1_danish_ci;
</pre>
</div>
<p>
MySQL按照下面的方式选择表字符集和 校对规则：
· 如果指定了CHARACTER SET X和COLLATE Y，那么采用CHARACTER SET X和COLLATE Y。
· 如果指定了CHARACTER SET X而没有指定COLLATE Y，那么采用CHARACTER SET X和CHARACTER SET X的默认校对规则。
· 否则，采用服务器字符集和服务器校对规则。
</p>
</li>
<li>列字符集和校对
每一个“字符”列（即，CHAR、VARCHAR或TEXT类型的列）有一个列字符集和一个列 校对规则，它不能为空。列定义语法有一个可选子句来指定列字符集和校对规则：
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>col_name <span style="color: #2aa198;">{</span>CHAR | VARCHAR | TEXT<span style="color: #2aa198;">}</span> <span style="color: #2aa198;">(</span>col_length<span style="color: #2aa198;">)</span>
<span class="linenr">2: </span><span style="color: #2aa198;">[</span>CHARACTER SET charset_name <span style="color: #b58900;">[</span>COLLATE collation_name<span style="color: #b58900;">]</span><span style="color: #2aa198;">]</span>
</pre>
</div>
<p>
例如：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE TABLE Table1 <span style="color: #2aa198;">(</span>
<span class="linenr">2: </span>    column1 VARCHAR<span style="color: #b58900;">(</span>5<span style="color: #b58900;">)</span> CHARACTER SET latin1 COLLATE latin1_german1_ci
<span class="linenr">3: </span><span style="color: #2aa198;">)</span>;
</pre>
</div>
<p>
MySQL按照下面的方式选择列字符集和校对规则：
· 如果指定了CHARACTER SET X和COLLATE Y，那么采用CHARACTER SET X和COLLATE Y。
· 如果指定了CHARACTER SET X而没有指定COLLATE Y，那么采用CHARACTER SET X和CHARACTER SET X的默认校对规则。
· 否则，采用表字符集和服务器校对规则。
CHARACTER SET和COLLATE子句是标准的SQL。
</p>
</li>
<li>字符集和校对分配示例
以下例子显示了MySQL怎样确定默认字符集和校对规则。
示例1：表和列定义
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE TABLE t1 <span style="color: #2aa198;">(</span>
<span class="linenr">2: </span>    c1 CHAR<span style="color: #b58900;">(</span>10<span style="color: #b58900;">)</span> CHARACTER SET latin1 COLLATE latin1_german1_ci
<span class="linenr">3: </span><span style="color: #2aa198;">)</span> DEFAULT CHARACTER SET latin2 COLLATE latin2_bin;
</pre>
</div>
<p>
在这里我们有一个列使用latin1字符集和latin1_german1_ci校对规则。是显式的定义，因此简单明了。需要注意的是，在一个latin2表中存储一个latin1列不会存在问题。
示例2：表和列定义
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE TABLE t1 <span style="color: #2aa198;">(</span>
<span class="linenr">2: </span>    c1 CHAR<span style="color: #b58900;">(</span>10<span style="color: #b58900;">)</span> CHARACTER SET latin1
<span class="linenr">3: </span><span style="color: #2aa198;">)</span> DEFAULT CHARACTER SET latin1 COLLATE latin1_danish_ci;
</pre>
</div>
<p>
这次我们有一个列使用latin1字符集和一个默认校对规则。尽管它显得自然，默认校对规则却不是表级。相反，因为latin1的默认校对规则总是latin1_swedish_ci，列c1有一个校对规则latin1_swedish_ci（而不是latin1_danish_ci）。
示例3：表和列定义
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE TABLE t1 <span style="color: #2aa198;">(</span>
<span class="linenr">2: </span>    c1 CHAR<span style="color: #b58900;">(</span>10<span style="color: #b58900;">)</span>
<span class="linenr">3: </span><span style="color: #2aa198;">)</span> DEFAULT CHARACTER SET latin1 COLLATE latin1_danish_ci;
</pre>
</div>
<p>
我们有一个列使用一个默认字符集和一个默认校对规则。在这种情况下，MySQL查找表级别来确定列字符集和 校对规则。因此，列c1的字符集是latin1，它的 校对规则是latin1_danish_ci。
示例4：数据库、表和列定义
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>CREATE DATABASE d1
<span class="linenr">2: </span>DEFAULT CHARACTER SET latin2 COLLATE latin2_czech_ci;
<span class="linenr">3: </span>USE d1;
<span class="linenr">4: </span>CREATE TABLE t1 <span style="color: #2aa198;">(</span>
<span class="linenr">5: </span>    c1 CHAR<span style="color: #b58900;">(</span>10<span style="color: #b58900;">)</span>
<span class="linenr">6: </span><span style="color: #2aa198;">)</span>;
</pre>
</div>
<p>
我们创建了一个没有指定字符集和校对规则的列。我们也没有指定表级字符集和校对规则。在这种情况下，MySQL查找数据库级的相关设置。（数据库的设置变为表的设置，其后变为列的设置。）因此，列c1的字符集为是latin2，它的 校对规则是latin2_czech_ci。
</p>
</li>
<li>连接字符集和校对
在客户端和服务器的连接处理中也涉及了字符集和校对规则变量。每一个客户端有一个连接相关的字符集和校对规则变量。
考虑什么是一个“连接”：它是连接服务器时所作的事情。客户端发送SQL语句，例如查询，通过连接发送到服务器。服务器通过连接发送响应给客户端，例如结果集。对于客户端连接，这样会导致一些关于连接的字符集和 校对规则的问题，这些问题均能够通过系统变量来解决：
· 当查询离开客户端后，在查询中使用哪种字符集？
服务器使用character_set_client变量作为客户端发送的查询中使用的字符集。
· 服务器接收到查询后应该转换为哪种字符集？
转换时，服务器使用character_set_connection和collation_connection系统变量。它将客户端发送的查询从character_set_client系统变量转换到character_set_connection（除非字符串文字具有象_latin1或_utf8的引介词）。collation_connection对比较文字字符串是重要的。对于列值的字符串比较，它不重要，因为列具有更高的 校对规则优先级。
· 服务器发送结果集或返回错误信息到客户端之前应该转换为哪种字符集？
character_set_results变量指示服务器返回查询结果到客户端使用的字符集。包括结果数据，例如列值和结果元数据（如列名）。
你能够调整这些变量的设置，或可以依赖默认值（这样，你可以跳过本章）。
有两个语句影响连接字符集：
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>SET NAMES <span style="color: #2aa198;">'charset_name'</span>
<span class="linenr">2: </span>SET CHARACTER SET charset_name
</pre>
</div>
<p>
SET NAMES显示客户端发送的SQL语句中使用什么字符集。因此，SET NAMES 'cp1251'语句告诉服务器“将来从这个客户端传来的信息采用字符集cp1251”。它还为服务器发送回客户端的结果指定了字符集。（例如，如果你使用一个SELECT语句，它表示列值使用了什么字符集。）
SET NAMES 'x'语句与这三个语句等价：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>mysql&gt; SET character_set_client = x;
<span class="linenr">2: </span>mysql&gt; SET character_set_results = x;
<span class="linenr">3: </span>mysql&gt; SET character_set_connection = x;
</pre>
</div>
<p>
将x设置为character_set_connection也就设置了collation_connection是x的默认校对规则。
SET CHARACTER SET语句是类似的，但是为 默认数据库设置连接字符集和校对规则。SET CHARACTER SET x语句与这三个语句等价：
</p>
<div class="org-src-container">

<pre class="src src-sql"><span class="linenr">1: </span>mysql&gt; SET character_set_client = x;
<span class="linenr">2: </span>mysql&gt; SET character_set_results = x;
<span class="linenr">3: </span>mysql&gt; SET collation_connection = @@collation_database;
</pre>
</div>
<p>
当一个客户端连接时，它向服务器发送希望使用的字符集名称。服务器为那个字符集设置character_set_client、character_set_results和 character_set_connection变量。（实际上，服务器为使用该字符集执行一个SET NAMES操作。）
对于mysql客户端，如果你希望使用与默认字符集不同的字符集，不需要每次启动时执行SET NAMES语句。可以在mysql语句行中或者选项文件中添加一个&#x2013;default-character-set选项设置。例如，每次运行mysql时，以下的选项文件设置把三个字符集变量修改为koi8r：
</p>
<div class="org-src-container">

<pre class="src src-conf"><span class="linenr">1: </span>[<span style="color: #b58900;">mysql</span>]
<span class="linenr">2: </span><span style="color: #268bd2;">default-character-set</span>=koi8r
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Jerry Xu</p>
<p class="date">Created: 2015-04-04 六 14:02</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
